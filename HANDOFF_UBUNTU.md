# ğŸ§ Ubuntuéƒ¨éšŠ å¼•ãç¶™ãæŒ‡ç¤ºæ›¸

## ğŸ“‹ æ¦‚è¦

DevRelayãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚µãƒ¼ãƒãƒ¼ï¼‹Linux Agentéƒ¨åˆ†ã®é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æ‹…å½“ã€‚
ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯80%å®Œæˆæ¸ˆã¿ã€‚æ®‹ã‚Šã¯ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€å‹•ä½œãƒ†ã‚¹ãƒˆã€æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã€‚

---

## ğŸ¯ æ‹…å½“ç¯„å›²

1. **ä¸­å¤®ã‚µãƒ¼ãƒãƒ¼** (`apps/server/`)
2. **Linux Agent** (`agents/linux/`)
3. **å…±é€šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸** (`packages/shared/`)
4. **ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©** (`scripts/install.sh`)

---

## ğŸ“¦ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ãƒªãƒã‚¸ãƒˆãƒªå–å¾—

```bash
# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å±•é–‹ï¼ˆtar.gzã‹ã‚‰ï¼‰
tar -xzvf devrelay-src.tar.gz
cd devrelay

# ã¾ãŸã¯æ–°è¦ä½œæˆã®å ´åˆ
mkdir devrelay && cd devrelay
# å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®
```

### 2. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# pnpmã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãªã‘ã‚Œã°ï¼‰
npm install -g pnpm

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install
```

### 3. ç’°å¢ƒè¨­å®š

```bash
# ã‚µãƒ¼ãƒãƒ¼è¨­å®š
cd apps/server
cp .env.example .env

# .envã‚’ç·¨é›†
# - DISCORD_BOT_TOKEN: Discord Developer Portalã§å–å¾—
# - DATABASE_URL: PostgreSQLæ¥ç¶šæ–‡å­—åˆ—ã‚’è¨­å®š
```

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–

```bash
cd apps/server
pnpm db:push
```

### 5. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1: ã‚µãƒ¼ãƒãƒ¼
pnpm dev:server

# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2: Agentï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
cd agents/linux
pnpm dev
```

---

## ğŸ”§ å¿…è¦ãªä½œæ¥­

### å¿…é ˆã‚¿ã‚¹ã‚¯

#### 1. Discord Botä½œæˆãƒ»è¨­å®š
```
1. https://discord.com/developers/applications ã«ã‚¢ã‚¯ã‚»ã‚¹
2. New Application â†’ åå‰: DevRelay
3. Bot â†’ Add Bot â†’ Tokenå–å¾—
4. OAuth2 â†’ URL Generator
   - Scopes: bot
   - Bot Permissions: Send Messages, Read Message History
5. ç”Ÿæˆã•ã‚ŒãŸURLã§Botã‚’ã‚µãƒ¼ãƒãƒ¼ã«æ‹›å¾…
6. .envã«ãƒˆãƒ¼ã‚¯ãƒ³è¨­å®š
```

#### 2. å‹•ä½œãƒ†ã‚¹ãƒˆ
```bash
# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pnpm dev:server

# Discord DMã§Botã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
# "h" â†’ ãƒ˜ãƒ«ãƒ—ãŒè¿”ã£ã¦ãã‚Œã°OK
# "m" â†’ ãƒã‚·ãƒ³ä¸€è¦§ï¼ˆæœ€åˆã¯ç©ºï¼‰
```

#### 3. Agentæ¥ç¶šãƒ†ã‚¹ãƒˆ
```bash
# Agentè¨­å®š
cd agents/linux
# ~/.devrelay/config.yaml ã‚’ç·¨é›†
# - serverUrl: ws://localhost:3000/ws/agent
# - token: ï¼ˆã‚µãƒ¼ãƒãƒ¼DBã§ç”Ÿæˆã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ï¼‰

# Agentèµ·å‹•
pnpm dev

# Discord ã§ "m" â†’ æ¥ç¶šã—ãŸãƒã‚·ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OK
```

#### 4. install.shãƒ†ã‚¹ãƒˆ
```bash
# åˆ¥ã®Ubuntuãƒã‚·ãƒ³ã§
curl -fsSL https://your-server/install.sh | bash
```

### è¿½åŠ ã‚¿ã‚¹ã‚¯ï¼ˆä½™è£•ãŒã‚ã‚Œã°ï¼‰

- [ ] Telegram Botå®Ÿè£… (`apps/server/src/platforms/telegram.ts`)
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
- [ ] ãƒ­ã‚°å‡ºåŠ›æ”¹å–„
- [ ] systemdã‚µãƒ¼ãƒ“ã‚¹å‹•ä½œç¢ºèª
- [ ] VPSãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

---

## ğŸ“ é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| `apps/server/src/index.ts` | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ |
| `apps/server/src/platforms/discord.ts` | Discord Bot |
| `apps/server/src/services/agent-manager.ts` | Agentæ¥ç¶šç®¡ç† |
| `apps/server/src/services/command-handler.ts` | ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ |
| `apps/server/prisma/schema.prisma` | DBã‚¹ã‚­ãƒ¼ãƒ |
| `agents/linux/src/index.ts` | Agentã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ |
| `agents/linux/src/services/connection.ts` | ã‚µãƒ¼ãƒãƒ¼æ¥ç¶š |
| `agents/linux/src/services/ai-runner.ts` | AI CLIå®Ÿè¡Œ |
| `packages/shared/src/types.ts` | å…±é€šå‹å®šç¾© |

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

### ã‚·ãƒŠãƒªã‚ª1: åŸºæœ¬ãƒ•ãƒ­ãƒ¼
```
1. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
2. Agentèµ·å‹•ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç™»éŒ²æ¸ˆã¿ï¼‰
3. Discordã§Botå®›ã«DM
4. "m" â†’ ãƒã‚·ãƒ³ä¸€è¦§è¡¨ç¤º
5. "1" â†’ ãƒã‚·ãƒ³é¸æŠ
6. "p" â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
7. "1" â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠã€Claude Codeèµ·å‹•
8. "hello" â†’ Claude Codeã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé€ä¿¡
9. å¿œç­”ãŒDiscordã«è¿”ã‚‹
10. "q" â†’ åˆ‡æ–­
```

### ã‚·ãƒŠãƒªã‚ª2: å†æ¥ç¶š
```
1. Agentã‚’åœæ­¢ãƒ»å†èµ·å‹•
2. ã‚µãƒ¼ãƒãƒ¼ã§è‡ªå‹•å†æ¥ç¶šã‚’ç¢ºèª
3. Discordã§ "m" â†’ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¢ºèª
```

---

## ğŸ› æƒ³å®šã•ã‚Œã‚‹å•é¡Œã¨å¯¾å‡¦

### WebSocketæ¥ç¶šã‚¨ãƒ©ãƒ¼
```
åŸå› : ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã€URLé–“é•ã„
å¯¾å‡¦: 
- serverUrlã‚’ç¢ºèªï¼ˆws:// or wss://ï¼‰
- ãƒãƒ¼ãƒˆé–‹æ”¾ç¢ºèª
- ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ç¢ºèª
```

### Discord BotãŒåå¿œã—ãªã„
```
åŸå› : ãƒˆãƒ¼ã‚¯ãƒ³é–“é•ã„ã€æ¨©é™ä¸è¶³
å¯¾å‡¦:
- ãƒˆãƒ¼ã‚¯ãƒ³å†ç¢ºèª
- Botæ¨©é™ç¢ºèªï¼ˆSend Messages, Read Message Historyï¼‰
- Intentsã«MessageContentãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹
```

### Prismaã‚¨ãƒ©ãƒ¼
```
åŸå› : ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´å¾Œã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æœªå®Ÿè¡Œ
å¯¾å‡¦: pnpm db:push
```

---

## ğŸ“ é€£çµ¡äº‹é …

- Windows Agentéƒ¨éšŠã¨ã®é€£æºãƒã‚¤ãƒ³ãƒˆ: `packages/shared/` ã®å‹å®šç¾©
- å‹ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ä¸¡éƒ¨éšŠã§åŒæœŸãŒå¿…è¦
- WebSocketãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å¤‰æ›´ã¯è¦ç›¸è«‡

---

## ğŸ“ å®Œäº†å ±å‘Šæ™‚ã«å«ã‚ã¦ã»ã—ã„æƒ…å ±

1. å‹•ä½œç¢ºèªçµæœï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç­‰ï¼‰
2. ç™ºè¦‹ã—ãŸå•é¡Œãƒ»ä¿®æ­£å†…å®¹
3. è¿½åŠ å®Ÿè£…ã—ãŸæ©Ÿèƒ½
4. æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³
5. æ®‹ã‚¿ã‚¹ã‚¯ä¸€è¦§
