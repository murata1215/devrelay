# ğŸŒ‰ DevRelay

> ã©ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‹ã‚‰ã§ã‚‚ã€ã©ã®AI CLIã«ã§ã‚‚ç¹‹ãŒã‚‹ã€ãƒªãƒ¢ãƒ¼ãƒˆé–‹ç™ºãƒãƒ–

LINEã€Discordã€Telegramã‹ã‚‰Claude Codeã€Gemini CLIç­‰ã‚’æ“ä½œã§ãã‚‹SaaSã€‚
å¤–å‡ºå…ˆã‹ã‚‰ã‚¹ãƒãƒ›ã§è‡ªå®…PCã®é–‹ç™ºç’°å¢ƒã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚

## âœ¨ Features

- **ãƒãƒ«ãƒãƒã‚·ãƒ³**: ubuntu01, ubuntu02, windows01... è¤‡æ•°ãƒã‚·ãƒ³ã‚’ç™»éŒ²ãƒ»åˆ‡ã‚Šæ›¿ãˆ
- **ãƒãƒ«ãƒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: å„ãƒã‚·ãƒ³å†…ã®è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç®¡ç†
- **ãƒãƒ«ãƒAI**: Claude Code, Gemini CLI, Aider ã«å¯¾å¿œ
- **ãƒãƒ«ãƒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Discord, Telegram ã‹ã‚‰æ“ä½œï¼ˆLINE å¯¾å¿œäºˆå®šï¼‰
- **è‡ªç„¶è¨€èªã‚³ãƒãƒ³ãƒ‰**: ã€Œå‰ã®æ¥ç¶šã‚’å¾©å…ƒã—ã¦ã€â†’ è‡ªå‹•ã§ `c` ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼ˆOpenAI API ä½¿ç”¨ï¼‰
- **ãƒ—ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰ / å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰**: ãƒ—ãƒ©ãƒ³ç«‹æ¡ˆâ†’æ‰¿èªâ†’å®Ÿè¡Œã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- **DevRelay Agreement**: CLAUDE.md ã«çµ±åˆã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—è¡¨ç¤º**: AI ã®å‡¦ç†çŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤º
- **åŒæ–¹å‘ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€**: Discord/Telegram â†” é–‹ç™ºãƒã‚·ãƒ³é–“ã®ãƒ•ã‚¡ã‚¤ãƒ«é€å—ä¿¡
- **å±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: ä¼šè©±å±¥æ­´ã‚’æ—¥åˆ¥ã« ZIP ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½
- **ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œ**: HTTP/HTTPS/SOCKS5 ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§ã®æ¥ç¶š

## ğŸ’¡ ãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡ã«ã¤ã„ã¦

DevRelay ã¯ Claude Code ã® `--resume` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ´»ç”¨ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¶™ç¶šã™ã‚‹ãŸã‚ã€**é€šå¸¸ã® CLI åˆ©ç”¨ã¨åŒç­‰ã®ãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡**ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

- **ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰**: ãƒ—ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰/å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰æŒ‡ç¤ºã§ç´„200ãƒˆãƒ¼ã‚¯ãƒ³/ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¶™ç¶š**: `--resume` ã«ã‚ˆã‚Šä¼šè©±ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒ Claude Code å´ã§ç®¡ç†ã•ã‚Œã‚‹ãŸã‚ã€å±¥æ­´ã®å†é€ä¿¡ã¯ä¸è¦
- **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º**: ä½¿ç”¨é‡ã‚’ Discord/Telegram ã§ç¢ºèªå¯èƒ½ï¼ˆ`ğŸ“Š Context: 131K / 200K tokens (66%)`ï¼‰

## ğŸ— Architecture

```
ğŸ“± Messaging Apps          â˜ï¸ Center Server           ğŸ–¥ï¸ Work Machines
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Discord      â”‚          â”‚              â”‚          â”‚ ubuntu01     â”‚
â”‚ Telegram     â”‚ â†â”€â”€â”€â”€â”€â”€â†’ â”‚ DevRelay    â”‚ â†â”€â”€â”€â”€â”€â”€â†’ â”‚ ubuntu02     â”‚
â”‚ LINE         â”‚  HTTPS   â”‚ Server       â”‚    WS    â”‚ windows01    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                         â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ PostgreSQL  â”‚         â”‚ Claude Code    â”‚
                         â”‚ Redis       â”‚         â”‚ Gemini CLI     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ Aider          â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ Packages

```
devrelay/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ server/           # ä¸­å¤®ã‚µãƒ¼ãƒãƒ¼ (Fastify + WebSocket + Discord.js)
â”‚   â””â”€â”€ web/              # Web UI (Vite + React)
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ shared/           # å…±é€šå‹ãƒ»å®šæ•°
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ linux/            # Linux Agent (Node.js CLI)
â”‚   â””â”€â”€ windows/          # Windows Agent (Electron ã‚¿ã‚¹ã‚¯ãƒˆãƒ¬ã‚¤ã‚¢ãƒ—ãƒª)
â””â”€â”€ scripts/
    â””â”€â”€ update-version.js # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸€æ‹¬æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

## ğŸš€ Quick Start

### 1. Install Agent (on your dev machine)

#### Linux Agent

```bash
# Clone repository
git clone https://github.com/murata1215/devrelay.git
cd devrelay

# Install dependencies
pnpm install

# Generate Prisma client (required for first build)
cd apps/server && npx prisma generate && cd ../..

# Build all packages
pnpm build
```

#### Windows Agent

Windows ã§ã¯ Electron ã‚¿ã‚¹ã‚¯ãƒˆãƒ¬ã‚¤ã‚¢ãƒ—ãƒªã¨ã—ã¦å‹•ä½œã—ã¾ã™ã€‚

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•:**
1. ãƒªãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ï¼ˆ`DevRelay-Agent-Setup-x.x.x.exe`ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å®Ÿè¡Œ
3. ã‚¿ã‚¹ã‚¯ãƒˆãƒ¬ã‚¤ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨­å®šç”»é¢ã‚’é–‹ã
4. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½åŠ 

**æ©Ÿèƒ½:**
- ã‚¿ã‚¹ã‚¯ãƒˆãƒ¬ã‚¤å¸¸é§ï¼ˆæ¥ç¶šçŠ¶æ…‹ã‚’ã‚¢ã‚¤ã‚³ãƒ³è‰²ã§è¡¨ç¤ºï¼šç·‘=æ¥ç¶šä¸­ã€ã‚°ãƒ¬ãƒ¼=åˆ‡æ–­ï¼‰
- è¨­å®šç”»é¢ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç®¡ç†ï¼‰
- è‡ªå‹•èµ·å‹•è¨­å®šï¼ˆWindows ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«è‡ªå‹•èµ·å‹•ï¼‰
- ã‚¹ãƒªãƒ¼ãƒ—é˜²æ­¢æ©Ÿèƒ½ï¼ˆæ¥ç¶šä¸­ã¯ Modern Standby ã‚’æŠ‘åˆ¶ï¼‰

**é–‹ç™º:**
```powershell
cd agents/windows
pnpm build
npx electron .

# é…å¸ƒç”¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ä½œæˆ
pnpm dist
```

### 2. Setup (Linux)

```bash
# Run setup (token only - machine name and URL auto-configured)
cd agents/linux
pnpm run setup  # Note: use "pnpm run setup", not "pnpm setup"

# Enter your connection token when prompted
# Token can be obtained from dashboard or generated manually
```

### 3. Start Agent (Linux)

```bash
# Manual start
cd agents/linux
pnpm run start

# As systemd service (setup will ask to install)
systemctl --user start devrelay-agent    # User service (recommended)
sudo systemctl start devrelay-agent       # System service

# Check status
systemctl --user status devrelay-agent
pnpm run status  # or from agents/linux directory

# View logs
journalctl --user -u devrelay-agent -f

# Uninstall (removes service, config, optionally project data)
pnpm run uninstall
```

### 4. Connect from Discord/Telegram

```
You: m
Bot: ğŸ“¡ ãƒã‚·ãƒ³ä¸€è¦§
     1. ubuntu01 ğŸŸ¢
     2. ubuntu02 ğŸŸ¢

You: 1
Bot: âœ… ubuntu01 ã«æ¥ç¶š

You: p
Bot: ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
     1. my-app
     2. another-project

You: 1
Bot: ğŸš€ my-app ã«æ¥ç¶š / Claude Code èµ·å‹•å®Œäº†

You: CSSã®ãƒã‚°ã‚’ç›´ã—ã¦
Bot: ğŸ¤– äº†è§£ã€ä¿®æ­£ä¸­...
```

## ğŸ“‹ Commands

| Command | Description |
|---------|-------------|
| `m` | ãƒã‚·ãƒ³ä¸€è¦§ |
| `p` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ |
| `c` | å‰å›ã®æ¥ç¶šå…ˆã«å†æ¥ç¶š |
| `e` / `exec` | å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒ—ãƒ©ãƒ³æ‰¿èªï¼‰ |
| `se` / `session` | ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±è¡¨ç¤º |
| `ag` / `agreement` | DevRelay Agreement ã‚’ CLAUDE.md ã«é©ç”¨ |
| `link` | Discord/Telegram ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ WebUI ã¨ãƒªãƒ³ã‚¯ |
| `1`, `2`, `3`... | ä¸€è¦§ã‹ã‚‰é¸æŠ |
| `x` | ä¼šè©±å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ |
| `q` | åˆ‡æ–­ |
| `h` | ãƒ˜ãƒ«ãƒ— |

ãã‚Œä»¥å¤–ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯AIã¸ã®æŒ‡ç¤ºã¨ã—ã¦å‡¦ç†ã•ã‚Œã¾ã™ã€‚

## ğŸ›  Development

### Prerequisites

- Node.js 20+
- pnpm 8+
- Discord Bot Token (for testing)

### Setup

```bash
# Clone
git clone https://github.com/murata1215/devrelay.git
cd devrelay

# Install dependencies
pnpm install

# Setup environment
cp apps/server/.env.example apps/server/.env
# Edit .env with your tokens

# Initialize database
cd apps/server
pnpm db:push

# Start development
pnpm dev:server   # Start server
pnpm dev:agent    # Start agent (in another terminal)
```

### Systemd Service (Production)

ã‚µãƒ¼ãƒ“ã‚¹åŒ–ã™ã‚‹ã¨è‡ªå‹•èµ·å‹•ãƒ»è‡ªå‹•å†èµ·å‹•ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

```bash
# Server
cd apps/server
pnpm setup:service
systemctl --user start devrelay-server

# WebUI
cd apps/web
pnpm setup:service
systemctl --user start devrelay-web

# Agent
cd agents/linux
pnpm run setup  # Choose "User service" option
systemctl --user start devrelay-agent
```

ç®¡ç†ã‚³ãƒãƒ³ãƒ‰:
```bash
systemctl --user status devrelay-server devrelay-web devrelay-agent  # çŠ¶æ…‹ç¢ºèª
systemctl --user restart devrelay-server devrelay-web devrelay-agent # å†èµ·å‹•
journalctl --user -u devrelay-server -f                               # ãƒ­ã‚°ç¢ºèª
```

### ãƒ—ãƒ­ã‚­ã‚·è¨­å®š

Agent ãŒãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã™ã‚‹å ´åˆã¯ã€`~/.devrelay/config.yaml` ã«è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

```yaml
proxy:
  url: http://proxy.example.com:8080  # ã¾ãŸã¯ socks5://proxy:1080
  username: user  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  password: pass  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³
```

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸€æ‹¬æ›´æ–°:
```bash
pnpm version:update 0.2.0
```

### Project Structure

```
apps/server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Entry point
â”‚   â”œâ”€â”€ db/client.ts          # Prisma client
â”‚   â”œâ”€â”€ platforms/
â”‚   â”‚   â”œâ”€â”€ discord.ts        # Discord bot
â”‚   â”‚   â””â”€â”€ telegram.ts       # Telegram bot
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ agent-manager.ts  # WebSocket connections
â”‚       â”œâ”€â”€ session-manager.ts # Active sessions
â”‚       â”œâ”€â”€ command-parser.ts # Parse user input
â”‚       â””â”€â”€ command-handler.ts # Execute commands
â””â”€â”€ prisma/
    â””â”€â”€ schema.prisma         # Database schema

agents/linux/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Agent entry
â”‚   â”œâ”€â”€ cli/                  # CLI commands
â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚       â”œâ”€â”€ setup.ts      # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã®ã¿ï¼‰
â”‚   â”‚       â”œâ”€â”€ uninstall.ts  # ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
â”‚   â”‚       â”œâ”€â”€ status.ts
â”‚   â”‚       â””â”€â”€ projects.ts
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ config.ts         # Config management
â”‚       â”œâ”€â”€ connection.ts     # WebSocket to server
â”‚       â”œâ”€â”€ projects.ts       # Project management
â”‚       â”œâ”€â”€ ai-runner.ts      # AI CLI execution
â”‚       â””â”€â”€ session-store.ts  # Session ID persistence

agents/windows/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ electron/
â”‚   â”‚   â””â”€â”€ main.ts           # Electron main process, tray, IPC
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ config.ts         # Config management (%APPDATA%\devrelay\)
â”‚       â”œâ”€â”€ connection.ts     # WebSocket to server
â”‚       â”œâ”€â”€ ai-runner.ts      # AI CLI execution
â”‚       â””â”€â”€ sleep-preventer.ts # Modern Standby prevention
â””â”€â”€ assets/
    â”œâ”€â”€ settings.html         # Settings UI
    â””â”€â”€ preload.js            # IPC bridge
```

## ğŸ” Security

- æ¥ç¶šãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹ãƒã‚·ãƒ³èªè¨¼
- APIã‚­ãƒ¼ã¯æš—å·åŒ–ä¿å­˜ï¼ˆAES-256-CBCï¼‰
- å…¨é€šä¿¡TLSæš—å·åŒ–
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ stdin çµŒç”±ï¼ˆ`ps aux` ã«è¡¨ç¤ºã•ã‚Œãªã„ï¼‰

## ğŸ—º Roadmap

- [x] Discord Bot
- [x] Telegram Bot
- [x] Linux Agent
- [x] Windows Agent
- [x] Web UI
- [x] Conversation Persistence (file-based)
- [x] Quick Reconnect (`c` command)
- [x] Real-time Progress Display
- [x] Systemd Service Support
- [x] Natural Language Commands (OpenAI API)
- [x] Plan Mode / Exec Mode
- [x] Agent Uninstall Command
- [x] Simplified Setup (token only)
- [x] DevRelay Agreement æ©Ÿèƒ½
- [x] ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸€å…ƒç®¡ç†
- [x] ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œ
- [x] å±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- [ ] LINE Bot
- [ ] AI Summary
- [ ] Team Features
- [ ] AI åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ï¼ˆGemini/Aiderï¼‰

## ğŸ“„ License

This project is licensed under the GNU General Public License v3.0 - see the [LICENSE](LICENSE) file for details.
